if(!Array.prototype.filter){Array.prototype.filter=function(fun){"use strict";if(this===void 0||this===null)throw new TypeError();var t=Object(this);var len=t.length>>>0;if(typeof fun!=="function")throw new TypeError();var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisArg,val,i,t))res.push(val);}}return res;};}var AutoNav={_currentTab:null,_$autoNav:"",_$navComplete:"",_$navNext:"",_$navHelper:"",_$navNextBtnText:"",_$navHelperBtnText:"",_$navFocusHelper:"",_isHidden:true,_autoNavStarted:false,_navInProgress:false,shouldExclude:function(tab){var $tab=$(tab);var tabType=$tab.attr('tabtype');var excludedTabsTypes=[window.c_TT_DateSigned,window.c_TT_EnvelopeID];var isExcludedTabType=$.inArray(tabType,excludedTabsTypes)!=-1;var customTabType=$tab.attr('customtabtype');var excludedCustomTabTypes=[window.c_CTT_Note];var isExcludedCustomTabType=$.inArray(customTabType,excludedCustomTabTypes)!=-1;var isLocked=$tab.is('[locked]')&&$tab[0].getAttribute('locked')==='true';var isbookmark=AutoNav.isBookmark(tab);var isVisible=AutoNav.isVisible(tab);var isDisabled=AutoNav.isDisabled(tab);return(isLocked&&!isbookmark)||isExcludedTabType||isExcludedCustomTabType||!isVisible||isDisabled;},isRequired:function(elem){var $elem=$(elem);var tabType=$elem.attr('tabtype');var isTab=AutoNav.isTab(elem);var isVisible=AutoNav.isVisible(elem);var hasRequiredAttribute=$elem.is('[required]')&&$elem[0].getAttribute('required')==='true';var isRequiredTabType=tabType===window.c_TT_SignerAttachment||tabType===window.c_TT_SignHere||tabType===window.c_TT_InitialHere||tabType===window.c_TT_Approve||tabType===window.c_TT_DigitalSignature||$elem.is('.InputTabRequired');return isTab&&isVisible&&(hasRequiredAttribute||isRequiredTabType);},isBlank:function(elem){return AutoNav.isTab(elem)&&(AutoNav.isBookmark(elem)||!CheckTabSigned(elem));},isTab:function(elem){return elem&&!AutoNav.isPage(elem);},isPage:function(elem){return elem&&$(elem).is('.Page');},isVisible:function(elem){return $(elem).is(':visible');},isEffectivelyLocked:function(elem){var $elem=$(elem);var customTabType=$elem.attr('customtabtype');var isLockedWithHiddenInput=customTabType==='Text'&&$elem.children('input').length===1&&$elem.children('[type="hidden"]').length===1;var isLockedWithNoInput=customTabType==='Text'&&$elem.children().length===0;return isLockedWithHiddenInput||isLockedWithNoInput;},isSharedRequired:function(elem){if(!window.SharedFieldForceAutoNav)return false;var $elem=$(elem);var isSharedField=$elem.hasClass('SharedFieldRequired')||($elem.children().hasClass('SharedFieldRequired')&&!AutoNav.isPage($elem));var isTouched=isSharedField?window.sharedFieldsObj[window.GetSharedFieldId(elem)].isTouched:false;return!isTouched&&isSharedField;},isInvalid:function(elem){return!!$(elem).attr('valerr');},isDisabled:function(elem){return!!$(elem).attr('disabled');},isBookmark:function(elem){var $elem=$(elem);var customTabType=$elem.attr('customtabtype');return customTabType==='Bookmark';},filteroption:["autoNavPage","autoNavReqd","autoNavBlankReqd","autoNavAll","autoNavPageReqd","autoNavPageBlankReqd","autoNavPageAll"],filters:{autoNavPage:function(elem){return AutoNav.isPage(elem);},autoNavReqd:function(elem){return AutoNav.isRequired(elem)&&!AutoNav.isEffectivelyLocked(elem)||(AutoNav.isSharedRequired(elem)&&!AutoNav.isEffectivelyLocked(elem));},autoNavBlankReqd:function(elem){return AutoNav.isBlank(elem)&&AutoNav.isRequired(elem)&&!AutoNav.isEffectivelyLocked(elem)||(AutoNav.isSharedRequired(elem)&&!AutoNav.isEffectivelyLocked(elem)||AutoNav.isInvalid(elem));},autoNavAll:function(elem){return AutoNav.isTab(elem)&&AutoNav.isVisible(elem)&&!AutoNav.isEffectivelyLocked(elem);},autoNavPageReqd:function(elem){return AutoNav.isPage(elem)||(AutoNav.isRequired(elem)&&!AutoNav.isEffectivelyLocked(elem)||(AutoNav.isSharedRequired(elem)&&!AutoNav.isEffectivelyLocked(elem)));},autoNavPageBlankReqd:function(elem){return AutoNav.isPage(elem)||(AutoNav.isBlank(elem)&&AutoNav.isRequired(elem)&&!AutoNav.isEffectivelyLocked(elem)||(AutoNav.isSharedRequired(elem)&&!AutoNav.isEffectivelyLocked(elem)));},autoNavPageAll:function(elem){return AutoNav.isVisible(elem)&&!AutoNav.isEffectivelyLocked(elem);}},_docElements:{allDocElements:[],filteredDocElements:[],buildElementsList:function(){this.allDocElements=[];var that=this;$('.PagesHolder').children('.Page').each(function(i,d){that.allDocElements.push(d);$(d).children('[tabtype], [customtabtype]').each(function(i,d){that.allDocElements.push(d);});});},buildFilteredList:function(){this.filteredDocElements=[];var filterMethod=AutoNav.filters[AutoNav.filteroption[res_NavRule]];this.filteredDocElements=this.allDocElements.filter(function(elem){return filterMethod(elem)&&!AutoNav.shouldExclude(elem);});},buildNavigableList:function(){this.buildElementsList();this.buildFilteredList();}},load:function(){this._docElements.buildNavigableList();this._$navHelper=$(GetE("navhelper"));this._$navComplete=$(GetE("navcomplete"));this._$navNext=$(GetE("navnext"));this._$navNextBtnText=$(GetE("navnexttext_btnInline"));this._$navHelperBtnText=$(GetE("navhelpertext_btnInline"));this._$navFocusHelper=$((GetE('navfocushelper')));this._$autoNav=$(GetE("holderNav"));this._$navHelper.css('display','none');this._$navComplete.css('display','none');this._$navNext.css('display','none');this._$navNextBtnText.css('display','none');this._$navHelperBtnText.css('display','none');this._$navFocusHelper.css('display','none');this._$autoNav.css('display','none');},init:function(){var isPageOnlyNavMode=res_NavRule==0;var isSinglePage=DSSigning.getPageCount()==1;if(!isPageOnlyNavMode||(isPageOnlyNavMode&&!isSinglePage)){this._showArrow();this._autoNavStarted=true;}},scroll:function(){this._setAutoNavToNext();},getNext:function(currElem){currElem=currElem||this._currentTab;if(res_NavRule!=0){this._docElements.buildNavigableList();var filteredList=this._docElements.filteredDocElements;var allList=this._docElements.allDocElements;var currIndexFiltered=$.inArray(currElem,filteredList);var currIndexAll=$.inArray(currElem,allList);if(currIndexFiltered==filteredList.length-1||currIndexAll==allList.length-1){res_NavRule=2;this._docElements.buildNavigableList();}return this._getNextElem(currElem);}return null;},setCurrentTab:function(tab){this._currentTab=tab;},navigateNext:function(currElem){var nextElem=this.getNext(currElem);if(nextElem){if(!currElem||this._isElemInViewport(currElem)||this.isPage(currElem)){if(this.isTab(nextElem)){this._alignArrowAndTab(nextElem);}else if(this.isPage(nextElem)){this._alignArrowAndPage(nextElem);}}else{if(this.isTab(currElem)){this._alignArrowAndTab(currElem);}else if(this.isPage(currElem)){this._alignArrowAndPage(currElem);}}return nextElem;}},goToNextPage:function(){this._docElements.buildNavigableList();var nextPageNum=1;if(this._currentTab){nextPageNum=(DSSigning.getCurrentPage()%DSSigning.getPageCount())+1;}var nextPageElem=$('.Page[pagenum='+nextPageNum+']')[0];this._alignArrowAndPage(nextPageElem);},getNavInProgressState:function(){return this._navInProgress;},_getNextElem:function(currElem){var fullList=this._docElements.allDocElements;var filteredList=this._docElements.filteredDocElements;if(!currElem){return filteredList[0];}var nextElem;var index=$.inArray(currElem,fullList);for(var i=index+1;i<fullList.length;i++){if($.inArray(fullList[i],filteredList)>=0){nextElem=fullList[i];break;}}return nextElem||filteredList[0];},_getPrevElem:function(currElem){var filteredList=this._docElements.filteredDocElements;var len=filteredList.length;var currElemIndex=$.inArray(currElem,filteredList);var prevElemIndex=(currElemIndex-1)%len;if(prevElemIndex<0)prevElemIndex=len-1;return filteredList[prevElemIndex];},_alignArrowAndTab:function(currElem){currElem=currElem||AutoNav._currentTab;if(currElem){if(this._isElemInViewport(currElem)&&this._canCenterElem(currElem)){this._centerTab(currElem,this._focusTab);this._centerArrow();this._setAutoNavText(currElem);if(!AutoNav.isBookmark(currElem)){this._flashThisTab(currElem);}}else{this._pointToTab(currElem,this._focusTab);this._setAutoNavText(currElem);if(!AutoNav.isBookmark(currElem)){this._flashThisTab(currElem);}}}},_alignArrowAndPage:function(nextPage){var $nextPage=$(nextPage);var pageTop=$nextPage.offset().top;var that=this;this._setNavInProgress(true);var callbackAlreadyCalled=false;$(window).off('scroll.autoNav');$('html, body').animate({scrollTop:pageTop-20},700,'swing',function(){if(callbackAlreadyCalled)return;callbackAlreadyCalled=true;that._focusTab(nextPage);$(window).one('scroll.autoNav',function(){var newPageTop=$nextPage.offset().top-that._getScrollTop();that._$autoNav.css({top:newPageTop+20});that._setAutoNavText(nextPage);});that._setNavInProgress(false);});},_getScrollTop:function(){var bodyScrollTop=$(document.body).scrollTop()||0;var htmlScrollTop=$('html').scrollTop()||0;return bodyScrollTop>htmlScrollTop?bodyScrollTop:htmlScrollTop;},_getScrollLeft:function(){var bodyScrollLeft=$(document.body).scrollLeft()||0;var htmlScrollLeft=$('html').scrollLeft()||0;return bodyScrollLeft>htmlScrollLeft?bodyScrollLeft:htmlScrollLeft;},_pointToTab:function(targetElem,focusCallback){var that=this;var $targetElem=$(targetElem);var elemMiddle=$targetElem.height()/2;var elemTop=$targetElem.offset().top;var newTop=elemTop+elemMiddle-this._$autoNav.height()/2-this._getScrollTop();if(this._isElemInViewport(targetElem)){this._$autoNav.css({top:newTop});focusCallback(targetElem);}else if(this._canCenterElem(targetElem)){this._centerTab(targetElem,focusCallback);this._centerArrow();}else{this._setNavInProgress(true);$(window).off('scroll.autoNav');$(window).one('scroll.autoNav',function(){that._setNavInProgress(false);});if(this._tabAtBeginning(targetElem)){$('html, body').scrollTop(0);}else{$('html, body').scrollTop(document.body.scrollHeight);}this._pointToTab(targetElem,focusCallback);}},_setNavInProgress:function(val){this._navInProgress=val||false;},_focusTab:function(currElem){var $currElem=$(currElem);var $elemToFocus=$currElem;if(AutoNav.isTab(currElem)){var $focusableElems=$currElem.children('input, textarea, button, select');if($focusableElems.length){$elemToFocus=$focusableElems.first().focus();}}else if(AutoNav.isPage($currElem)){$elemToFocus=$currElem;$elemToFocus.attr('tabIndex',0);}$elemToFocus.focus();},_flashThisTab:function(currElem){var that=this;var flashInterval=300;var numberOfFlashes=3;var flashCount=0;function changeBackgroundColor(elem){$(elem||currElem).css("background-color","#F89829");}function resetBackgroundColor(elem){$(elem||currElem).css("background-color","");}function flash(){if(that._prevFlash){resetBackgroundColor(that._prevFlash.elem);clearTimeout(that._prevFlash.flashTimeoutId);that._prevFlash=null;}if(flashCount<numberOfFlashes){flashCount++;changeBackgroundColor();flash.flashTimeoutId=setTimeout(function(){resetBackgroundColor();flash.flashTimeoutId=setTimeout(flash,flashInterval);},flashInterval);}}this._prevFlash=this._currFlash;this._currFlash=flash;flash.elem=currElem;flash();},_setAutoNavText:function(targetElem){if(!targetElem){this._flattenArrow();this._$navNextBtnText.text(res_NavNext);}else if(this.isPage(targetElem)){this._flattenArrow();if(res_NavRule==0)this._$navNextBtnText.text(res_NavNextPage);else this._$navNextBtnText.text(res_NavNext);}else{if(AutoNav.isBookmark(targetElem)){this._flattenArrow();this._$navNextBtnText.text(res_NavNext);}else{this._unflattenArrow();var $currElem=$(targetElem);var tabtype=$currElem.attr('tabtype');var customTabType=$currElem.attr('customtabtype');if($.inArray(tabtype,[window.c_TT_Custom,window.c_TT_Company,window.c_TT_Title])>=0){if($.inArray(customTabType,[c_CTT_List,c_CTT_Radio])>=0)this._$navNextBtnText.text(res_NavChoose);else if($.inArray(customTabType,[c_CTT_Checkbox])>=0)this._$navNextBtnText.text(res_NavSelect);else if(($currElem.attr('formkuppos')!="true")&&(customTabType!="Note")&&(customTabType!=c_CTT_Formula))this._$navNextBtnText.text(res_NavFill);}else if(tabtype==window.c_TT_InitialHere)this._$navNextBtnText.text(res_NavInitial);else if(tabtype==window.c_TT_SignHere)this._$navNextBtnText.text(res_NavSign);else if($.inArray(tabtype,[window.c_TT_InitialHereOptional,window.c_TT_SignHereOptional])>=0)this._$navNextBtnText.text(res_NavOptional);else if($.inArray(tabtype,[window.c_TT_SignerAttachment,window.c_TT_SignerAttachmentOptional])>=0)this._$navNextBtnText.text(res_NavAttach);else if($.inArray(tabtype,[window.c_TT_Approve,window.c_TT_Decline])>=0)this._$navNextBtnText.text(res_NavChoose);}}},_setAutoNavToNext:function(){if(res_NavRule!=0){this._flattenArrow();this._$navNextBtnText.text(res_NavNext);}},_changeFillIntoNext:function(){if(res_NavRule!=0)this._$navNextBtnText.text(res_NavNext);},_distanceFromCenter:function(nextElem){var $targetElem=$(nextElem);var viewportHeight=$(window).height();var elemHeight=$targetElem.height();var elemTop=$targetElem.offset().top;var elemCenter=elemTop+elemHeight/2;return Math.abs(viewportHeight/2-elemCenter);},_canCenterElem:function(nextElem){return!this._tabAtBeginning(nextElem)&&!this._tabAtEnd(nextElem);},_tabAtBeginning:function(nextElem){var $targetElem=$(nextElem);var viewportHeight=$(window).height();var scrollHeight=document.body.scrollHeight;var elemHeight=$targetElem.height();var elemTop=$targetElem.offset().top;var elemCenter=elemTop+elemHeight/2;var elemAtBeginning=elemCenter<viewportHeight/2;return elemAtBeginning;},_tabAtEnd:function(nextElem){var $targetElem=$(nextElem);var viewportHeight=$(window).height();var scrollHeight=document.body.scrollHeight;var elemHeight=$targetElem.height();var elemTop=$targetElem.offset().top;var elemCenter=elemTop+elemHeight/2;var elemAtEnd=scrollHeight-elemCenter<viewportHeight/2;return elemAtEnd;},_isElemInViewport:function(nextElem){return this._isElemInVerticalViewport(nextElem);},_isElemInHorizontalViewport:function(nextElem){var $nextElem=$(nextElem);var viewportWidth=$(window).width();var docScrollLeft=this._getScrollLeft();var elemOffset=$nextElem.offset();var elemWidth=$nextElem.width();var minLeft=docScrollLeft;var maxLeft=docScrollLeft+viewportWidth;return elemOffset.left>minLeft&&elemOffset.left+elemWidth<maxLeft;},_isElemInVerticalViewport:function(nextElem){var $nextElem=$(nextElem);var viewportHeight=$(window).height();var docScrollTop=this._getScrollTop();var elemOffset=$nextElem.offset();var elemHeight=$nextElem.height();var minTop=docScrollTop;var maxTop=docScrollTop+viewportHeight;return elemOffset.top>minTop&&elemOffset.top+elemHeight<maxTop;},_centerTab:function(targetElem,focusCallBack){var that=this;var $targetElem=$(targetElem);var viewportHeight=$(window).height();var elemHeight=$targetElem.height();var elemOffset=$targetElem.offset();var offset=elemOffset.top-viewportHeight/2+elemHeight/2;var callbackAlreadyCalled=false;this._setNavInProgress(true);$(window).off('scroll.autoNav');$('html, body').animate({scrollTop:(offset)},500,'swing',function(){if(callbackAlreadyCalled)return;callbackAlreadyCalled=true;focusCallBack(targetElem);$(window).one('scroll.autoNav',function(){that._setNavInProgress(false);});});},_centerArrow:function(){var viewportHeight=$(window).height();var arrowHeight=this._$autoNav.height();var newTop=viewportHeight/2-arrowHeight/2;var currentTop=parseInt(this._$autoNav.css('top'));if(currentTop!==newTop){this._$autoNav.css({top:newTop});}},_flattenArrow:function(){this._$navHelper.css('display','none');this._$navFocusHelper.css('display','none');},_unflattenArrow:function(){this._$navHelper.css('display','block');this._$navFocusHelper.css('display','block');},_hideArrow:function(){var that=this;setTimeout(function(){that._$navNext.css('display','none');that._$navHelper.css('display','none');that._isHidden=true;},0);},_showArrow:function(){if(DSSigning.getCanFinish()||DSSigning.getNeedsPayment())return;var that=this;function show(){that._$autoNav.css('display','block');that._$navNextBtnText.css('display','block');that._$navFocusHelper.css('display','block');that._$navNext.css('display','block');that._$navHelper.css('display','block');that._isHidden=false;}if(res_NavRule==0&&DSSigning.getPageCount()>1){show();var currPageNum=(DSSigning.getCurrentPage());var currPageElem=$('.Page[pagenum='+currPageNum+']')[0];this._alignArrowAndPage(currPageElem);}else if(res_NavRule!=0){show();this._alignArrowAndTab(AutoNav._currentTab);}}};$(function(){if(window.FillSharedFieldObj&&window.SharedFieldForceAutoNav)window.FillSharedFieldObj();if(window.IsMob()){var canAutoNav=typeof res_NavRule!='undefined';if(canAutoNav){AutoNav._docElements.buildNavigableList();}}else{DSSigning.on('documentEnabled',function(){var canAutoNav=typeof res_NavRule!='undefined';if(canAutoNav){AutoNav.load();AutoNav.init();$('.NavHolder').hide().fadeIn();DSSigning.on('autoNavGutterReady',function(){$('.NavHolder').stop().hide().fadeIn();});if(AutoNav._autoNavStarted){hookUpEventListeners();}}});function hookUpEventListeners(){DSSigning.on('typingInTextArea',function(){var canAutoNav=typeof res_NavRule!='undefined';if(canAutoNav)AutoNav._changeFillIntoNext();});function showOrHideArrow(){var canAutoNav=typeof res_NavRule!='undefined';if(canAutoNav){if((DSSigning.getCanFinish()||DSSigning.getNeedsPayment())&&AutoNav._autoNavStarted)AutoNav._hideArrow();else if(AutoNav._isHidden&&AutoNav._autoNavStarted)AutoNav._showArrow();}}DSSigning.on('canFinishChanged',showOrHideArrow);DSSigning.on('needsPaymentChanged',showOrHideArrow);DSSigning.on('manualScrollFinished',function(){var canAutoNav=typeof res_NavRule!='undefined';if(canAutoNav)AutoNav.scroll();});DSSigning.on('pageCountChanged',function(){var canAutoNav=typeof res_NavRule!='undefined';if(!canAutoNav)return;if(res_NavRule==0){if(DSSigning.getPageCount()>1){AutoNav.init();AutoNav._showArrow();}else{AutoNav._hideArrow();}}});var currentTime;var currentScrollEventTime=0;var previousScrollEventTime=0;var scrollEventDelta=0;var mostRecentScrollWasFromAutoNav=false;var minScrollEventDeltaTime=500;var scrollWasManual=false;var timeoutId;DSSigning.on('navigableElementFocused',function(){clearTimeout(timeoutId);});$(window).scroll(function(){scrollWasManual=!AutoNav._navInProgress;previousScrollEventTime=currentScrollEventTime;currentScrollEventTime=+(new Date());scrollEventDelta=currentScrollEventTime-previousScrollEventTime;clearTimeout(timeoutId);timeoutId=setTimeout(function(){if(scrollWasManual){DSSigning.trigger('manualScrollFinished');}},minScrollEventDeltaTime);});}}});