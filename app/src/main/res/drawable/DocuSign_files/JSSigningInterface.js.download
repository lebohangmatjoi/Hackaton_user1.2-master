(function(global,$){var DSSigning=global.DSSigning={init:init,save:save,finish:finish,exit:exit,voidEnvelope:voidEnvelope,correct:correct,clone:clone,resend:resend,share:share,getFormDataUrl:getFormDataUrl,showChanges:showChanges,markup:markup,close:close,setCurrentPage:setCurrentPage,getPageCount:getPageCount,rotatePage:rotatePage,autoNavigate:autoNavigate,navigateToTab:navigateToTab,navigateToNextPage:navigateToNextPage,navigateToPreviousPage:navigateToPreviousPage,setGeoLocation:setGeoLocation,isFreeformEnabled:isFreeformEnabled,setSelectedFreeformTabType:setSelectedFreeformTabType,getConsumerDisclosure:getConsumerDisclosure,setConsumerDisclosureAccepted:setConsumerDisclosureAccepted,applyFormFields:applyFormFields,applyDigitalCertificate:applyDigitalCertificate,finishAdoptSignature:finishAdoptSignature,adoptSignature:finishAdoptSignature,getAdoptSignatureTabDetails:getAdoptSignatureTabDetails,setTabValue:setTabValue,toggleTab:toggleTab,needsAdopt:needsAdopt,cancelAdoptSignature:cancelAdoptSignature,setExternalAuthenticationData:setExternalAuthenticationData,setInPersonSignerIdCheckAnswer:setInPersonSignerIdCheckAnswer,setInPersonSignerEmail:setInPersonSignerEmail,getDeclineOptions:getDeclineOptions,decline:decline,getAddCCRecipientsOptions:getAddCCRecipientsOptions,addCCRecipients:addCCRecipients,getCurrentPage:getCurrentPage,getDateSigned:getDateSigned,getEnvelopePdfUrl:getEnvelopePdfUrl,getZippedEnvelopePdfUrl:getZippedEnvelopePdfUrl,getCertificatePdfUrl:getCertificatePdfUrl,showEnvelopeChanges:global.showEnvelopeChanges,downloadForSignOnPaperUpload:downloadForSignOnPaperUpload,downloadForSignOnPaperFax:downloadForSignOnPaperFax,cancelSignOnPaperFax:cancelSignOnPaperFax,getFaxAttachmentCount:getFaxAttachmentCount,finishSignOnPaperUpload:finishSignOnPaperUpload,finishSignOnPaperFax:finishSignOnPaperFax,finishInPersonSigning:finishInPersonSigning,getAllowedZoomLevels:getAllowedZoomLevels,getZoom:getZoom,setZoom:setZoom,zoomIn:zoomIn,zoomOut:zoomOut,continueSigning:continueSigning,isSuppressed:isSuppressed,start:start,getCanFinish:getCanFinish,setLanguage:setLanguage,cancelSignLater:cancelSignLater,getNeedsPayment:getNeedsPayment,digitalCertificateAuthenticated:digitalCertificateAuthenticated,finishPayment:finishPayment,cancelPayment:cancelPayment,setPaymentNameOnCard:setPaymentNameOnCard,cancelSetPaymentNameOnCard:cancelSetPaymentNameOnCard,getAttachments:getAttachments,removeAttachment:removeAttachment,finishUploadAttachments:finishUploadAttachments,requestFaxAttachment:requestFaxAttachment,cancelFaxAttachment:cancelFaxAttachment,printFaxAttachmentCoverSheets:printFaxAttachmentCoverSheets,get:get,set:set,show:show,sendMessage:sendMessage,handleMessage:handleMessage,extend:extend,editDocument:editDocument,setSuppressMarkupDialog:setSuppressMarkupDialog,getSuppressMarkupDialog:getSuppressMarkupDialog,applySigningReasonToTab:applySigningReasonToTab,cancelTabAuthentication:cancelTabAuthentication,onAccountAuthenticated:onAccountAuthenticated,authorizePayment:authorizePayment,checkCompletionState:checkCompletionState,checkNeedsPayment:checkNeedsPayment,checkCanFinish:checkCanFinish,getUiVersion:getUiVersion,getApiVersion:getApiVersion};function LogAction(actionType,message){var logged=false;var data={};data.actionType=actionType;data.message=message;$.ajax({type:'POST',async:false,url:'DocuSignXML.aspx/LogAction'+GetTI(true),contentType:'application/json;charset=UTF-8',dataType:'json',data:JSON.stringify(data),success:function(r){},error:function(jqXhr,textStatus){result=null;}});}function digitalCertificateAuthenticated(data){if(data.errors&&data.errors.length>0){var message="Unkown error";if(data.errors[0].code){message=data.errors[0].code;}LogAction("requestedinvalid",message);alert(res_DigitalCertificateError);return;}else{var hdnDigSigResponse=GetE('hdnDigitalSignaturesResponse');if(hdnDigSigResponse){if(global.DigitalSignatureUseSignedPayloads=="1"){hdnDigSigResponse.value=data;}else{hdnDigSigResponse.value=JSON.stringify(data);}}LogAction("requestedvalid","");var ha=GetE('hdnSignAction');if(ha)ha.value='complete';DSSigning.finish();}}function get(propName){var methodName='get'+propName.charAt(0).toUpperCase()+propName.substring(1);return DSSigning[methodName]();}function set(propName,val){var methodName;if(typeof propName!=='string'){var propHash=propName
for(var key in propHash){methodName='set'+key.charAt(0).toUpperCase()+key.substring(1);DSSigning[methodName](propHash[key]);}}else{methodName='set'+propName.charAt(0).toUpperCase()+propName.substring(1);DSSigning[methodName](val);}return DSSigning;}function show(bongoId,data){DSSigning.sendMessage('show',$.extend({id:bongoId},data));}var DSSigningAttributes={};function internalSendMessageMethod(messageName,data){if((/Changed$/).test(messageName)){var attrName=messageName.replace(/^(.*)Changed$/,'$1');var backboneCompatChangeEvent='change:'+attrName;var value=data!=null&&typeof data[attrName]!=='undefined'?data[attrName]:data;var origValue=DSSigningAttributes[attrName];if(value!==origValue){DSSigningAttributes[attrName]=value;DSSigning.trigger(backboneCompatChangeEvent,value);DSSigning.trigger(messageName,data);}}}function log(msg){if(DSSigning.showLogging&&console&&console.log){console.log(msg);}}function init(options){options=options||{};sendMessageMethod=options.sendMessage?options.sendMessage:_sendMessage;DSSigning.sendMessage=function(){internalSendMessageMethod.apply(null,arguments);sendMessageMethod.apply(DSSigning,arguments);};if(options.handleMessage)DSSigning.handleMessage=options.handleMessage;if(options.formatResult)formatResult=options.formatResult;while(_sendMessageQueue.length>0){var message=_sendMessageQueue.shift();DSSigning.sendMessage(message.name,message.data);}if(signingOptions.Version==1){$.extend(suppressedItems,options.suppress,suppressedItems);}else{$.extend(suppressedItems,options.suppress);}global.initComplete=true;DSSigning.trigger('initComplete');return this;}var suppressedItems_V1={acceptConsumerDisclosureDialog:function(){if(signingOptions.Version==1){return platform==='ios'||platform==='android'||platform==='windows';}},inPersonSignerEmailDialog:function(){if(signingOptions.Version==1){return platform==='ios'||platform==='android';}},applyFormFieldsDialog:function(){if(signingOptions.Version==1){return!(typeof SendMessageToWebView=="undefined");}},adoptSignatureDialog:function(){if(signingOptions.Version==1){return typeof(ShowAdoptExternal)=="function";}},declineDialog:function(){if(signingOptions.Version==1){return(platform==='ios'||platform==='android'||platform==='windows')&&typeof(ShowDeclineExternal)=="function";}}};var suppressedItems=signingOptions.Version==1?suppressedItems_V1:{};function isSuppressed(key){if(typeof suppressedItems[key]==='function'){return suppressedItems[key]();}else{return!!suppressedItems[key];}}function getUiVersion(){return formatResult('getUiVersion',window.res_UseIframeless?2:1);}function getApiVersion(){return formatResult('getApiVersion',signingOptions.Version);}function save(callback,callbackErr){global.SaveTabData&&global.SaveTabData(callback,callbackErr);}function finish(){if(isSuppressed("addCCRecipientsDialog")&&!finish.addCCRecipientsRequestedSent){var options=getAddCCRecipientsOptions();if(options.subject!=null){DSSigning.sendMessage('addCCRecipientsRequested',options);finish.addCCRecipientsRequestedSent=true;return formatResult('finish',{finished:false});}}return formatResult('finish',{finished:global.CompSign&&global.CompSign()});}function exit(){return global.SelectAction&&global.SelectAction("Later")||{redirectImmediate:true};}function voidEnvelope(){global.SelectAction('Void');}function correct(){global.SelectAction('Correct');}function clone(){global.SelectAction('Clone');}function resend(){global.SelectAction('ResendFreeform');}function share(){global.SelectAction('Share');}function getFormDataUrl(){return('EnvelopeFormData.aspx'+GetTime(true)+GetTI(false));}function showChanges(){global.SelectAction('EnvelopeDataChanges');}function markup(){global.SelectAction('Edit');}function close(){global.SelectAction('Close');}function setCurrentPage(page){AutoNav.setCurrentTab(GetPageByNumber(page));if(0<page&&page<=DSSigning.getPageCount()){var curPage=GetE('curPage');curPage.value=page;global.ResetPage(curPage);}}function getCurrentPage(){return+GetE('curPage').value;}function getDateSigned(){var dateSigned=global.GetCurDt&&global.GetCurDt()||'';return formatResult('getDateSigned',dateSigned);}function navigateToNextPage(){var pageNum=DSSigning.getCurrentPage();var page=GetPageByNumber(pageNum);var nextPage=global.NextPg(page);AutoNav.setCurrentTab(nextPage);if(global.ScrollToNextOrPrev){global.ScrollToNextOrPrev(true,false);}}function navigateToPreviousPage(){var pageNum=DSSigning.getCurrentPage();var page=GetPageByNumber(pageNum);var prevPage=global.GetPreviousPage(page);AutoNav.setCurrentTab(prevPage);if(global.ScrollToNextOrPrev){global.ScrollToNextOrPrev(false,false);}}function getPageCount(){var pageCount=document.querySelectorAll('.Page').length;return formatResult('getPageCount',pageCount);}function rotatePage(direction){if(global.PageRot){if(direction==='left'){global.PageRot('rotateleft');}else{global.PageRot('rotateright');}return true;}return false;}function autoNavigate(id){if(!id){global.NavHelper(true);return;}var $page=$('.Page[pageid="'+id+'"]');if($page.length){DSSigning.setCurrentPage($page.attr('pagenum'));}else{DSSigning.navigateToTab(id);}}function navigateToTab(tabId){global.NavToTab(tabId);}function setGeoLocation(data){global.SetGeoLocPos({coords:data.coords||data});}function isFreeformEnabled(){return formatResult('isFreeformEnabled',global.IsSignerPlaced&&global.IsSignerPlaced());}function setSelectedFreeformTabType(tabType){if(global.MOBSIGN){MOBSIGN.setSelectedTagType(tabType);}}function getConsumerDisclosure(){var esignAgreement=global.GetE('acceptEsign'),senderName=global.GetE('acceptEsignSenderName'),senderCompany=global.GetE('acceptEsignSenderCompany');if(senderName&&senderCompany&&esignAgreement){return formatResult('getConsumerDisclosure',{senderName:senderName.textContent,senderCompany:senderCompany.textContent,esignAgreement:esignAgreement.innerHTML});}else{return formatResult('getConsumerDisclosure',{});}}function setConsumerDisclosureAccepted(isAccepted){if(isAccepted!==false){if(global.GetE("chkUserEsign")){global.GetE("chkUserEsign").checked=true;}global.StartReview();}}function start(options){var canStartReview=options&&options.disclosureAccepted;if(DSSigning._core&&DSSigning._core.welcome){DSSigning._core.welcome.set(options);canStartReview=DSSigning._core.welcome.isValid();}setConsumerDisclosureAccepted(canStartReview);return canStartReview;}function getCanFinish(){if(global.HasSharedField)return!!global.alltabssigned&&!getNeedsPayment()&&global.allSharedFieldRequiredTabsTouched();else return!!global.alltabssigned&&!getNeedsPayment();}function getNeedsPayment(){var needsPayment=window.PaymentNeeds?window.PaymentNeeds(true):false;return!!global.alltabssigned&&needsPayment;}function finishUploadAttachments(attachment){if(!attachment||!attachment.tabId||!attachment.documents||!attachment.documents.length){return;}var pageAppendString="";var curDocId=null;var pagesAdded=[];for(var x=0,documentCount=attachment.documents.length;x<documentCount;x++){if(!attachment.documents[x].pages||!attachment.documents[x].pages.length){continue;}for(var y=0,pageCount=attachment.documents[x].pages.length;y<pageCount;y++){if(curDocId!==null&&curDocId!==attachment.documents[x].documentId){global.UplFrLoad(attachment.tabId,pageAppendString,true);pageAppendString="";}curDocId=attachment.documents[x].documentId;var page=attachment.documents[x].pages[y];if(pageAppendString!=="")pageAppendString+="~";pageAppendString+=page.number;pageAppendString+=":";pageAppendString+=page.pageId;pageAppendString+=":";pageAppendString+=curDocId;pageAppendString+=":";pageAppendString+=page.width;pageAppendString+=":";pageAppendString+=page.height;pageAppendString+=":";if(attachment.documents[x].name){pageAppendString+=attachment.documents[x].name.replace(":","##colon##").replace("~","##tilde##");}pageAppendString+=":";pageAppendString+=page.owner;pagesAdded.push({documentId:curDocId,documentName:attachment.documents[x].name,pageId:page.pageId,number:page.number,width:page.width,height:page.height});}}global.UplFrLoad(attachment.tabId,pageAppendString,true);DSSigning.sendMessage('pagesAdded',{pages:pagesAdded});DSSigning.sendMessage('pageCountChanged',DSSigning.getPageCount());DSSigning.sendMessage('progressStarted');DSSigning.getAttachments(attachment.tabId,function(newAttachment){DSSigning.sendMessage('progressFinished');DSSigning.sendMessage('attachmentChanged',newAttachment);DSSigning.sendMessage('pageCountChanged',DSSigning.getPageCount());});}function getAttachments(tabId,callback){var faxId;var faxHiddenId=GetE('faxid_'+tabId);if(faxHiddenId){faxId=faxHiddenId.value;}var faxStatus;var faxHiddenStatus=GetE('faxstatus_'+tabId);if(faxHiddenStatus){faxStatus=faxHiddenStatus.value;}var tabDocumentId;var tabEl=GetE(tabId);if(tabEl){tabDocumentId=EAttr(tabEl.parentNode,'docid');}jQuery.ajax({cache:false,type:'GET',dataType:'JSON',url:'attachment/get?tabId='+tabId+global.GetTI(false)}).then(function(obj){if(callback){if(obj.errorMessage){callback({errorMessage:obj.errorMessage});return;}var documents=obj.documents||[];var attachments={tabId:tabId,uploadUrl:fillOutUrl('attachment/put?documentId='+tabDocumentId+'&tabId='+tabId+global.GetTI(false)),tabDocumentId:tabDocumentId,documents:[],isConcatMode:obj.isConcatMode,allowMultipleAttachments:obj.allowMultipleAttachments,totalAttachments:obj.totalAttachments};if(faxId){attachments.faxId=faxId;}if(faxStatus){attachments.faxStatus=faxStatus;}for(var i=0,len=documents.length;i<len;i++){var document={documentId:documents[i].DocumentId,name:documents[i].DocumentName,pages:[]};if(documents[i].PageIds!=null){var pageIds=documents[i].PageIds.split('~');for(var j=0;j<pageIds.length;j++){if(pageIds[j]){document.pages.push({pageId:pageIds[j]});}}}attachments.documents.push(document);}callback(attachments);}},function(err){if(callback){callback({errorMessage:err});}});}function removeAttachment(tabId,attachment){if(!attachment||!attachment.pages||!attachment.pages.length){return;}var pageIds=attachment.pages[0].pageId;for(var i=1;i<attachment.pages.length;i++){pageIds+='~'+attachment.pages[i].pageId;}jQuery.ajax({type:'POST',responseType:'JSON',url:'attachment/delete'+global.GetTI(true),data:{tabId:tabId,documentId:attachment.documentId,pageIds:pageIds}}).then(function(response){if(response.errorMessage){DSSigning.sendMessage('signingErrorOccurred',{errorMessage:response.errorMessage});}global.removePagesFromDOM(pageIds);DSSigning.sendMessage('pagesRemoved',{pages:attachment.pages});DSSigning.getAttachments(tabId,function(newAttachment){DSSigning.sendMessage('attachmentChanged',newAttachment);DSSigning.sendMessage('pageCountChanged',DSSigning.getPageCount());if((!newAttachment.documents||!newAttachment.documents.length)&&!newAttachment.faxId){global.ResetSignerAttachmentIcon(tabId);}});},function(err){DSSigning.sendMessage('signingErrorOccurred',{errorMessage:err});});}function requestFaxAttachment(tabId){global.ShowFaxAttach(tabId);}function cancelFaxAttachment(tabId,faxId){global.CancelFaxAttach(faxId,tabId);}function printFaxAttachmentCoverSheets(){global.PrintFaxCover();}function getFaxAttachmentCount(){var hdnSignerAttachmentTabs=global.GetE('hdnSignerAttachmentTabs');var faxCount=0;if(hdnSignerAttachmentTabs){var tabs=hdnSignerAttachmentTabs.value.split(";");for(var i=0;i<tabs.length;i++){var tab=GetE(tabs[i]);if(tab){var tabId=GuidFromId(tab);var faxId=GetE('faxid_'+tabId);if(faxId&&faxId.value){faxCount++;}}}}return faxCount;}function finishPayment(){if(global.PaymentCompSign){var action=global.GetE('hdnSignAction');if(action){action.value='complete';global.PaymentCompSign();}}}function cancelPayment(){if(global.PaymentCancel){global.PaymentCancel();}}function setPaymentNameOnCard(name){global.PaymentButtonGet(name);}function cancelSetPaymentNameOnCard(){global.CancelPaymentButtonGet();}function setLanguage(languageCode){DSSigning.sendMessage('progressStarted');languageCode=languageCode.replace(/-/g,'_');global.MasterPageAction('setlang-'+languageCode,true);}function cancelSignLater(){var action=global.GetE('hdnSignAction');if(action&&action.value=='signlater'){action.value='';}}function applyFormFields(yes){if(global.FormFieldYes){if(yes!==false){global.FormFieldYes();}else{global.FormFieldNo();}return true;}return false;}function applyDigitalCertificate(data){data=data||{};var form=global.res_DigitalCertificateSignerInputData;var formFields=form.fields||[];var dataFields=data.fields||[];var i;var formLen;for(i=0,formLen=formFields.length;i<formLen;i++){if(!formFields[i].locked){for(var j=0,dataLen=dataFields.length;j<dataFields.length;j++){if(formFields[i].id===dataFields[j].id){formFields[i].value=dataFields[j].value;break;}}}}var valueByKey={};for(i=0,formLen=formFields.length;i<formLen;i++){if(formFields[i].required&&!formFields[i].value){DSSigning.sendMessage('signingErrorOccurred',{errorMessage:global.res_DigitalCertificateError});return;}if(formFields[i].value){valueByKey[formFields[i].id]=formFields[i].value;}}if(global.CompletePkiInfo){global.CompletePkiInfo(valueByKey);}}function finishAdoptSignature(data){data=data||{};var updateNameTabs=function($elem,txt){var $input=$elem.find('input, textarea');$input.val(txt);$elem.find('span').text(txt);if($elem.find('input').length>0)global.AutoGrow($elem.find('input')[0]);};var zeroGuid='00000000-0000-0000-0000-000000000000';if(data.signatureGuid!==zeroGuid){var signatureGuid=data.signatureGuid;}if(data.initialsGuid!==zeroGuid){var initialsGuid=data.initialsGuid;}if(data.fullname){$('[tabtype="FullName"]').each(function(i,v){updateNameTabs($(v),data.fullname);});$('[tabtype="FirstName"]').each(function(i,v){updateNameTabs($(v),data.firstname);});$('[tabtype="LastName"]').each(function(i,v){updateNameTabs($(v),data.lastname);});}var adoptCanceled=!signatureGuid&&!initialsGuid;if(adoptCanceled){global.ExternalAdoptCanceled&&global.ExternalAdoptCanceled();}else{global.ExternalAdoptFinished&&global.ExternalAdoptFinished(signatureGuid,initialsGuid);}}function cancelAdoptSignature(){finishAdoptSignature();}function getAdoptSignatureTabDetails(){return formatResult('getAdoptSignatureTabDetails',global.GetAdoptTabDetails(global.curAdptSigTab));}function setTabValue(id,value){var $tab=$('#ds_hldrBdy_'+id);var $input=$('#ds_hldrBdy_custom_'+id);if(!$input.length){$input=$('#ds_custom_'+id);}if($input.attr('type')==='radio'||$input.attr('type')==='checkbox'){$input.prop('checked',value);}else{$input.val(value);}global.ValCustTab&&global.ValCustTab($input[0]);global.ToggleTabCustom($tab[0],false,false,{target:$input[0]});$input.keyup();if(typeof $input[0].onclick==='function'){$input[0].onclick();};tabChangesQueue.push(id);DSSigning.sendMessage('tabCountUpdate',{tabs:tabChangesQueue});}function toggleTab(id){var $tab=$('#ds_hldrBdy_'+id).add('#'+id).eq(0);if((/SignHere|SignHereOptional|InitialHere|InitialHereOptional|Approve/).test($tab.attr('tabtype'))){global.ToggleTab($tab[0]);}var idPos=tabChangesQueue.indexOf(id);if(idPos!=-1){tabChangesQueue.splice(idPos,1);}else{tabChangesQueue.push(id);DSSigning.sendMessage('tabCountUpdate',{tabs:tabChangesQueue});}}function needsAdopt(id){var tab=$('#ds_hldrBdy_'+id).add('#'+id)[0];if(!tab){return;}var isSigned=global.IsSigned(tab);var isSignInEachLocation=global.res_SignInEachLocation;if(isSignInEachLocation){return!isSigned;}else if(!global.NeedToAdopt){return false;}else{return global.NeedToAdopt(tab);}}function setInPersonSignerIdCheckAnswer(answer){if(answer&&DSSecurity!=null){DSSecurity.setInPersonSignerAnswer(answer);}}function setInPersonSignerEmail(email){var emailFieldId='txtIPEmail',emailField=global.GetE(emailFieldId);if(emailField==null){var emailElement=global.document.createElement('input');emailElement.id=emailFieldId;global.document.body.appendChild(emailElement);}emailField=global.GetE(emailFieldId);emailField.value=email;global.SubmitIP(true);}function getDeclineOptions(){getDeclineOptions._hasBeenCalled=true;var btn=GetE("dlgDecline_btnDecline_btnInline");if(!GetE('divDclInner')||!btn){return formatResult('getDeclineOptions',{});}global.LoadXml("divDclInner","decline");var listReasons=null,ddDeclineReason=global.GetE('ddDeclineReason');if(ddDeclineReason){listReasons=[];var optionElems=ddDeclineReason.getElementsByTagName('option');for(var i=1;i<optionElems.length;i++){listReasons.push(optionElems[i].innerText);}}return formatResult('getDeclineOptions',{canWithdrawConsent:(global.GetE('rowDeclineWithdrawMsg')!=null),canUseOwnReason:(global.GetE('txtDeclineReason')!=null),reasonChoices:listReasons,reasonIsRequired:(!EAttr(btn,"declineblank")||EAttr(btn,"declineblank")!="true")});}function decline(data){if(!getDeclineOptions._hasBeenCalled){DSSigning.getDeclineOptions();}data=data||{};var reason=data.reason;var consentWithdrawn=data.consentWithdrawn==null?true:false;var btn=GetE("dlgDecline_btnDecline_btnInline");if(!global.DoDecline||!btn){log('Decline is not supported on this envelope.');return formatResult('decline',{declineAllowed:false});}if((!reason||$.trim(reason)==="")&&(!EAttr(btn,"declineblank")||EAttr(btn,"declineblank")!=="true")){log('Cannot decline this envelope without specifying a reason.');return formatResult('decline',{declineAllowed:false});}global.declineEnabled=true;if(global.DeclineWithdraw)global.DeclineWithdraw(consentWithdrawn);var ddDeclineReason=global.GetE('ddDeclineReason');if(ddDeclineReason)ddDeclineReason.value=reason;var txtDeclineReason=global.GetE('txtDeclineReason');if(txtDeclineReason)txtDeclineReason.value=reason;global.DoDecline();return formatResult('decline',{declineAllowed:true});}function getAddCCRecipientsOptions(){var txtSubj=global.GetE("txtCCSubject");if(!txtSubj){return formatResult('getAddCCRecipientsOptions',{});}var subjText=txtSubj.value;var txtMsg=global.GetE("txtCCMsg");var msgText=(txtMsg)?txtMsg.value:"";return formatResult('getAddCCRecipientsOptions',{subject:subjText,message:msgText});}function addCCRecipients(data){if(!data)return;if(data.subject){var txtSubj=global.GetE("txtCCSubject");if(txtSubj)txtSubj.value=data.subject;}if(data.message!=null){var txtMsg=global.GetE("txtCCMsg");if(txtMsg)txtMsg.value=data.message;}if(data.recipients){for(i=0;i<data.recipients.length;i++){var txtCCEmails=global.GetE("txtCCEmails"+(i+1).toString());if(!txtCCEmails){global.DocuSignItAddEmail();txtCCEmails=global.GetE("txtCCEmails"+(i+1).toString());}if(txtCCEmails)txtCCEmails.value=data.recipients[i].email;var txtCCName=global.GetE("txtCCName"+(i+1).toString());if(txtCCName)txtCCName.value=data.recipients[i].name;}}}function print(){}function fillOutUrl(partialUrl){return window.location.href.replace(/DocuSign.aspx.*$/i,partialUrl);}function getEnvelopePdfUrl(options){options=options||{};var optionalParameters='';var showSignatures=!!global.retDLUrlIncSigs;var showChanges=!!global.showEnvelopeChanges;if(options.showSignatures||showSignatures){optionalParameters+='&sigs=1';}if(options.showChanges||showEnvelopeChanges){optionalParameters+='&sc=1';}if(options.documentId){optionalParameters+='&d='+options.documentId;}return fillOutUrl('EnvelopePDF.aspx?showdoc=true&ws=1&s=2'+optionalParameters+global.GetTI());}function getZippedEnvelopePdfUrl(options){options=options||{};var optionalQueryStringParameters='';var showDataFieldChangesGlobal=!!global.showEnvelopeChanges;var showDataFieldChangesParameterValue='0';if(options.showChanges||showDataFieldChangesGlobal){showDataFieldChangesParameterValue='1';}optionalQueryStringParameters+='&sc='+showDataFieldChangesParameterValue;return fillOutUrl('Download/Zip?&s=1'+global.GetTI()+optionalQueryStringParameters);}function getCertificatePdfUrl(){if(global.GenerateUrlForIndividualPDF){return fillOutUrl(global.GenerateUrlForIndividualPDF(signingOptions.certDocumentId,'Summary',false,true,false));}}function downloadForSignOnPaperUpload(){if(global.DownloadSOP){global.DownloadSOP(getEnvelopePdfUrl());}}function downloadForSignOnPaperFax(){if(global.FaxSOP){global.FaxSOP(getEnvelopePdfUrl());}}function cancelSignOnPaperFax(){if(global.CancelSOPFax){global.CancelSOPFax();}}function finishSignOnPaperUpload(){var action=GetE('hdnSignAction');action.value='signonpaperuploadcomplete';SubmitIt(false);}function finishSignOnPaperFax(){global.CompleteSOP();}function finishInPersonSigning(){if(!global.res_IPSprLogin){global.InPersonSignerHostAuthenticate();}else{global.IPDone();}}function getSubject(){var subject=$('.SubjectHeaderTxt').children("div").html().trim();return formatResult("getSubject",subject);}var zoomLevelMap={50:50,75:72,100:96,115:112,150:150,250:250};var zoomLevelReverseMap={50:50,72:75,96:100,112:115,150:150,250:250};var zoomLevels={50:{prev:50,next:75},75:{prev:50,next:100},100:{prev:75,next:115},115:{prev:100,next:150},150:{prev:115,next:250},250:{prev:150,next:250}};function getAllowedZoomLevels(){return[50,75,100,115,150,250];}function getZoom(){return zoomLevelReverseMap[DSSigningVars.zoom||global.zoom];}function setZoom(percent){if(!percent)percent=100;if(zoomLevelMap[percent]){if(global.HideResizeObject){global.HideResizeObject();}global.SelectZoom({id:zoomLevelMap[percent]});}}function zoomIn(){setZoom(zoomLevels[getZoom()].next);}function zoomOut(){setZoom(zoomLevels[getZoom()].prev);}function continueSigning(){global.SessionPing();}function sendMessage(messageName,data){_sendMessageQueue.push({name:messageName,data:data});}var _sendMessageQueue=[];function _sendMessage(messageName,data){DSSigning.trigger(messageName,data);}function handleMessage(messageName,handler){DSSigning.on(messageName,function(data){log('handleMessage => '+messageName);handler&&handler(data);});}function formatResult(methodName,result){return result;}function extend(obj){global.DSSigning||(global.DSSigning={});for(var key in obj){DSSigning[key]=obj[key];}}function editDocument(){global.EditDocument();}function setSuppressMarkupDialog(val){var suppress=GetE('hdnSuppressMarkupDialog');suppress.value=val?"1":"0";}function getSuppressMarkupDialog(){var suppress=GetE('hdnSuppressMarkupDialog');return suppress.value==="1";}function applySigningReasonToTab(tabId,reason,authenticationData){global.ApplySigningReasonToTab(tabId,reason,authenticationData);}function cancelTabAuthentication(tabId){global.CancelTabAuthentication(tabId);}function setExternalAuthenticationData(authenticationData){global.setExternalAuthenticationData(authenticationData);}function onAccountAuthenticated(data){global.onAccountAuthenticated({},data);}function authorizePayment(options){var AdvPayService=global.AdvancedPaymentService;var tabId=options.tabId;var url=fillOutUrl('payments/authorize'+GetTI(true));var reqBody={paymentMethod:options.paymentMethod,idempotencyKey:options.idempotencyKey};switch(options.paymentMethod){case'creditcard':reqBody.creditCardData=options.creditCardData;break;case'applepay':reqBody.applePayData=options.applePayData;break;case'androidpay':reqBody.androidPayData=options.androidPayData;break;default:throw new Error('Invalid or undefined payment method: '+options.paymentMethod);};var fireAuthorizeResponse=function(data){DSSigning.sendMessage('authorizePaymentResponse',data);};var req=$.post(url,reqBody)
req.done(function(data,statusText,jqXHR){fireAuthorizeResponse(data);AdvPayService.updatePaymentStatus(tabId,AdvPayService.STATUS_AUTH_COMPLETE);});req.fail(function(jqXHR,statusText,error){fireAuthorizeResponse(JSON.parse(jqXHR.responseText));});return req;}function checkCompletionState(forceEvent){DSSigning.checkNeedsPayment(forceEvent);DSSigning.checkCanFinish(forceEvent);}function checkNeedsPayment(forceEvent){var AdvPayService=global.AdvancedPaymentService;var needsPayment=DSSigning.getNeedsPayment();if((needsPayment!==global.oldNeedsPayment)||forceEvent){global.paymentdisplay=needsPayment;var eventData={needsPayment:needsPayment};if(AdvPayService.isAdvancedPaymentsEnabled()&&needsPayment){eventData.paymentDetails=AdvPayService.paymentDetails();}DSSigning.sendMessage('needsPaymentChanged',eventData);global.oldNeedsPayment=needsPayment;}return needsPayment;}function checkCanFinish(forceEvent){var canFinish=DSSigning.getCanFinish();if((canFinish!==global.oldCanFinish)||forceEvent){var eventData={canFinish:canFinish};DSSigning.sendMessage('canFinishChanged',eventData);global.oldCanFinish=canFinish;}return canFinish;}})(this,jQuery);(function(global,$){DSSigning.extend({trigger:trigger,on:on});var jQueryObj=$({});function trigger(eventName,data){jQueryObj.trigger(eventName,[data]);}function on(eventName,handler){jQueryObj.on(eventName,handler);}})(this,jQuery);var DSSigningVars={};(function(global,$){global.DSSigningVars.zoom=null;function repairPageNavigation(){var hasCurPageElem=global.GetE('curPage');if(!hasCurPageElem){var GetEOrig=global.GetE;var fakeCurPage={id:'curPage',prevpage:"1",value:"1",setAttribute:function(name,val){fakeCurPage[name]=val;},getAttribute:function(name){return fakeCurPage[name];},blur:function(){}};function GetENew(id){if(id==='curPage'){return fakeCurPage;}else{return GetEOrig(id);}}global.GetE=GetENew;}}DSSigning.on('JScriptSigning.loaded',repairPageNavigation);DSSigning.on('JScriptSigning.loaded',function(){DSSigning.checkCompletionState();});$(document).on('click',function(){try{if(window.parent&&window.parent!=window){window.parent.$(window.parent.document).trigger('click');}}catch(ex){}});})(this,jQuery);(function(global,$){function getTabType(elem){var tabType='';if(elem){tabType=$(elem).attr('tabtype');if(tabType==='Custom'){tabType=$(elem).attr('customtabtype');}}return tabType;}function getCurrentTabInfo(tabElem){var currentTabType=getTabType(tabElem);var isComplete;if(currentTabType==global.c_TT_SignHereOptional||currentTabType==global.c_TT_InitialHereOptional){var hdnTab=global.GetE("here_"+global.GuidFromId(tabElem));if(hdnTab)isComplete=hdnTab.value=="signed";else isComplete=global.CheckTabSigned(tabElem);}else isComplete=global.CheckTabSigned(tabElem);return{type:currentTabType,isComplete:isComplete};}DSSigning.getCurrentTabInfo=getCurrentTabInfo;})(this,jQuery);(function(global,$){var documentEnabled=false;function disable(){$(global.document).ready(function(){documentEnabled=false;$(document.body).on('focus.prevent','*',function(e){if(this===e.target&&global.openDialogs.length===0){document.body.tabIndex=0;document.body.focus();}});var holder=$('.BodyHolder');$(holder).append($overlay);});}function enable(){DSSigning.trigger('documentEnabled');$(document.body).off('focus.prevent','*');documentEnabled=true;delete document.body.tabIndex;$overlay.detach();}DSSigning.on('JScriptSigning.loadStarted',function(){try{var DS=(window.parent&&window.parent.DS)||{};if(DS.reinit&&DS.needsReinit){DS.reinit(DSSigning);}DS.needsReinit=true;if(signingOptions.BongoDialogsTurnedOn){initBongoDialogs();disable();$('.overlay').on('click',function(){DSSigning.sendMessage('documentInteractionAttempted');});DSSigning.sendMessage('signingRendered');}if(window.parent&&window.parent.$){var parent$=window.parent.$;var $parentDoc=parent$(window.parent.document);$parentDoc.on('focus','.shared',function(){var sharedField=global.GetE($(this).attr('data-id'));global.MarkFieldTouched(sharedField);});$parentDoc.on('blur change keydown','.tab-form-element, .tab-button',function(e){var tabGuid=parent$(this).closest('.doc-tab').attr('data-id');var $iframedTab=$(global.GetE(tabGuid));var eventType=e.type==='focusout'?'blur':e.type;if(eventType=='blur'){$iframedTab.find('[onblur]').blur();$iframedTab.filter('[onblur]').blur();}else if(eventType=='change'){$iframedTab.find('[onchange]').change();$iframedTab.filter('[onchange]').change();}else if(eventType==='keydown'&&e.which===13){$iframedTab.find('[type="text"][onblur]').blur();}});}}catch(ex){}});function initBongoDialogs(){var OrigDInit=global.DInit;var OrigDOut=global.DOut;var OrigClDlg=global.ClDlg;var OrigDCenter=global.DCenter;var legacyDialogIdMap={"dlgHistory":"history","dlgChSigner":"change-signer","dlgDecline":"decline-warning","dlgConDisc":"consumer-disclosure","dlgSOP":"sign-on-paper","dlgAdoptSig":"adopt-signature","dlgStart":"welcome","dlgComplete":"complete"};if(DSSigning.getUiVersion()!==1){legacyDialogIdMap["dlgIPComplete"]="in-person-complete";}function getBongoDialogId(legacyId){return legacyDialogIdMap[legacyId];}function DInitBongo(legacyId){var bongoId=getBongoDialogId(legacyId);if(bongoId&&bongoId!=='complete'){}else{OrigDInit.apply(null,arguments);}}function DOutBongo(legacyId,_,_,_,_,_,options){var bongoId=getBongoDialogId(legacyId);if(bongoId&&bongoId!=='complete'){if(options&&options.dialogId){bongoId=options.dialogId;}if(bongoId&&bongoId==='in-person-complete'&&res_IPSprEmail&&res_IPSuppPass&&DSSigning.getUiVersion()!==1){DSSigning.finishInPersonSigning();}else{DSSigning.show(bongoId,options);}}else{if(legacyId!=='dlgAddressing'){DSSigning.sendMessage('_iframeDialogShown');}OrigDOut.apply(null,arguments);if(bongoId==='complete'&&$('#divWaitForComplete').is(':visible')){global.ShowWaitForComplete();}}}function ClDlgBongo(legacyId){var bongoId=getBongoDialogId(legacyId);if(bongoId&&bongoId!=='complete'){}else{if(bongoId==='complete'){DSSigning.sendMessage('progressFinished');}DSSigning.sendMessage('_iframeDialogHidden');OrigClDlg.apply(null,arguments);}}function CenterDialogBongo(legacyId){var bongoId=getBongoDialogId(legacyId);if(bongoId&&bongoId!=='complete'){}else{OrigDCenter.apply(null,arguments);}}if(!(/MemberSignatureManager/).test(window.location.href)){global.DInit=DInitBongo;global.DOut=DOutBongo;global.ClDlg=ClDlgBongo;global.DCenter=CenterDialogBongo;}}var $overlay=$('<div class="overlay"></div>');$overlay.css({position:'fixed',top:0,height:'100%',width:'100%',display:'block',backgroundColor:'#000',zIndex:301});var currentTab=null;var previousTab=null;$(document).on('focus','[tabtype], [customtabtype], .Page',function(e){DSSigning.trigger('navigableElementFocused');if($(this).is('.Page')&&!$(e.target).is('.Page')){return;}if($(this).is('.Page')&&$(e.target).is('.Page')){AutoNav._currentTab=currentTab=global.currentTab=this;return;}AutoNav._currentTab=currentTab=global.currentTab=this;if(previousTab!==currentTab&&documentEnabled){DSSigning.sendMessage('currentTabInfoChanged',DSSigning.getCurrentTabInfo(currentTab));previousTab=currentTab;}else if(!documentEnabled){DSSigning.sendMessage('_disabledIframeFocusAttempted',DSSigning.getCurrentTabInfo(currentTab));}});DSSigning.enable=enable;DSSigning.disable=disable;})(this,jQuery);